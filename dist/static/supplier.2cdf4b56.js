var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,s=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t;import{f as d}from"./date.23847c74.js";import{K as o}from"./KzEmpty.e30b69b6.js";import{K as i}from"./KzPage.d586fb1f.js";import{K as n}from"./KzUpload.48a7e92e.js";import{_ as p}from"./KzCascader.839740a3.js";import{K as c}from"./KzDmpTitle.5be6dd26.js";import{_ as m,m as v,B as y,O as f,R as b,E as _,e as g,T as h}from"./index.81e0e33e.js";import{H as k,u as w,g as V,j,_ as x,o as F,I as C,J as z,a as T,w as q,B as O,a2 as K,W as U,c as P,a0 as E,P as B,aa as D,a1 as I,ax as M,b as S,ae as H}from"./vue.fa004e33.js";import{o as N,a as R,b as A}from"./seekAbroad.981a3428.js";import"./tinymce.50e98bcc.js";const J={class:"kz_card dmp_page"},L={class:"fsc mb20"},W=I("新增需求"),$={class:"dmp_table"},G={class:"fcs"},Q={class:"fcs"},X=I("详情"),Y=I("---"),Z=I("驳回原因"),ee={key:3,class:"line"},ae=I("删除"),le={class:"flexr"},te=I("取消"),re=I("确认"),ue=k((se=((e,a)=>{for(var l in a||(a={}))r.call(a,l)&&s(e,l,a[l]);if(t)for(var l of t(a))u.call(a,l)&&s(e,l,a[l]);return e})({},{name:"Supplier"}),a(se,l({setup(e){const a=v(),l=w((()=>a.state.typeHash)),t=w((()=>a.state.countryList)),r=V(0),u=V(10),s=V(1);M();const m=V(!1),k=V(!1),I=V(!1),ue=V(),se=V(),de=V({industryType:[],country:"",name:"",desc:"",updateFile:""}),oe=V(),ie=V([]),ne=j({industryType:[{required:!0,message:"请选择行业分类",trigger:"blur"}],country:[{required:!0,message:"请选择地区",trigger:"blur"},{required:!0,message:"请选择地区",trigger:"change"}],name:[{required:!0,message:"请输入采购商品",trigger:"change"},{required:!0,message:"请输入采购商品",trigger:"blur"}],desc:[{required:!0,message:"请输入描述",trigger:"change"},{required:!0,message:"请输入描述",trigger:"blur"}],updateFile:[{validator:(e,a,l)=>{switch(oe.value){case"size":l(new Error("请添加大小不超过4M的文件"));break;case"type":l(new Error("请添加 .doc、.docx、.pdf、.xls、.xlsx 格式的文件"));break;default:l()}},trigger:"change"}]}),pe=async()=>{m.value=!0;const e={current:s.value,type:2,size:10},{status:a,body:l}=await N(e);m.value=!1,a&&(r.value=l.total,ie.value=l.records)};pe();const ce=()=>{ue.value.validate((e=>{if(!e)return!1;k.value=!0,de.value.updateFile?se.value.submit():ye()}))},me=e=>{e?(oe.value=e,de.value.updateFile="",ue.value.validateField("updateFile",(()=>null))):(oe.value="",ue.value.clearValidate("updateFile"))},ve=e=>{de.value.updateFile="",oe.value="none",se.value.clear(),k.value=!1,g("上传失败")},ye=e=>{A({attachment:e||"",demand_desc:de.value.desc,product_name:de.value.name,type:2,country_id:de.value.country,industry_id:de.value.industryType.join(",")}).then((e=>{e.status?(I.value=!1,ue.value.resetFields(),s.value=1,pe()):(de.value.updateFile="",se.value.clear()),k.value=!1})).catch((()=>{k.value=!1,ve()}))},fe=()=>{k.value=!1,oe.value="none",se.value.clear(),ue.value.resetFields()},be=e=>{k.value?h().then((()=>{e()})).catch((()=>{})):e()};return(e,a)=>{const v=S("el-button"),g=S("el-table-column"),h=S("el-link"),w=S("el-table"),V=S("el-form-item"),j=S("el-option"),M=S("el-select"),N=S("el-input"),A=S("el-form"),oe=S("el-dialog"),_e=H("loading");return x((F(),C("div",J,[z("div",L,[T(c),T(v,{type:"primary",icon:O(y),onClick:a[0]||(a[0]=e=>I.value=!0)},{default:q((()=>[W])),_:1},8,["icon"])]),z("div",$,[T(w,{data:ie.value},{empty:q((()=>[T(o)])),default:q((()=>[T(g,{type:"selection",width:"50"}),T(g,{property:"id",label:"ID"}),T(g,{property:"industry_id",label:"行业分类"},{default:q((e=>[z("div",null,K(O(f)(e.row.industry_id.split(","),O(l),"last")),1)])),_:1}),T(g,{property:"country_id",label:"地区"}),T(g,{property:"product_name",label:"采购商品"}),T(g,{property:"demand_desc",label:"描述"}),T(g,{property:"create_time",label:"发起时间"},{default:q((({row:e})=>[z("div",null,K(O(d)(new Date(Number(e.create_time)),"yyyy-MM-dd")),1)])),_:1}),T(g,{property:"status",label:"状态"},{default:q((({row:e})=>[z("div",G,[z("div",{class:U(["status_dot",O(b)(e.status).className])},null,2),z("div",null,K(O(b)(e.status).text),1)])])),_:1}),T(g,{property:"user_name",label:"创建人"}),T(g,{label:"操作",width:"300"},{default:q((({row:a})=>[z("div",Q,[4===a.status?(F(),P(h,{key:0,type:"primary",onClick:l=>e.$router.push("/product/dmp/seekabroad/supplierdetails?id="+a.id)},{default:q((()=>[X])),_:2},1032,["onClick"])):E("",!0),2===a.status?(F(),P(h,{key:1,type:"primary"},{default:q((()=>[Y])),_:1})):E("",!0),3===a.status?(F(),P(h,{key:2,type:"primary",onClick:e=>(e=>{_.alert(e.fail_reason||"暂没有驳回原因，请联系管理员","驳回原因",{confirmButtonText:"确认"})})(a)},{default:q((()=>[Z])),_:2},1032,["onClick"])):E("",!0),2!==a.status&&1!==a.status?(F(),C("div",ee)):E("",!0),2!==a.status?(F(),P(h,{key:4,type:"primary",onClick:e=>(e=>{_.confirm("是否确认删除?","操作提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((async()=>{const a={id:e.id},{status:l}=await R(a);l&&pe()}))})(a)},{default:q((()=>[ae])),_:2},1032,["onClick"])):E("",!0)])])),_:1})])),_:1},8,["data"])]),T(i,{page:s.value,"onUpdate:page":a[1]||(a[1]=e=>s.value=e),size:u.value,"onUpdate:size":a[2]||(a[2]=e=>u.value=e),total:r.value,onChange:pe},null,8,["page","size","total"]),T(oe,{modelValue:I.value,"onUpdate:modelValue":a[9]||(a[9]=e=>I.value=e),width:500,draggable:"",title:"添加需求","before-close":be,onClose:fe},{footer:q((()=>[z("div",le,[T(v,{disabled:k.value,onClick:a[8]||(a[8]=e=>I.value=!1)},{default:q((()=>[te])),_:1},8,["disabled"]),T(v,{type:"primary",disabled:k.value,onClick:ce},{default:q((()=>[re])),_:1},8,["disabled"])])])),default:q((()=>[x((F(),P(A,{ref_key:"formRef",ref:ue,model:de.value,rules:O(ne),"label-width":"80px"},{default:q((()=>[T(V,{label:"行业分类",required:"",prop:"industryType"},{default:q((()=>[T(p,{modelValue:de.value.industryType,"onUpdate:modelValue":a[3]||(a[3]=e=>de.value.industryType=e),type:"type"},null,8,["modelValue"])])),_:1}),T(V,{label:"选择地区",prop:"country"},{default:q((()=>[T(M,{modelValue:de.value.country,"onUpdate:modelValue":a[4]||(a[4]=e=>de.value.country=e),class:"f1",placeholder:"请选择地区",clearable:""},{default:q((()=>[(F(!0),C(B,null,D(O(t),(e=>(F(),P(j,{key:e.code,label:e.country_name,value:e.code},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),T(V,{label:"供应产品",required:"",prop:"name"},{default:q((()=>[T(N,{modelValue:de.value.name,"onUpdate:modelValue":a[5]||(a[5]=e=>de.value.name=e),placeholder:"请输入产品名称",clearable:""},null,8,["modelValue"])])),_:1}),T(V,{label:"需求描述",required:"",prop:"desc"},{default:q((()=>[T(N,{modelValue:de.value.desc,"onUpdate:modelValue":a[6]||(a[6]=e=>de.value.desc=e),type:"textarea",maxlength:"150","show-word-limit":"",class:"input_textarea",placeholder:"可简要描述对寻找地区的供应服务商的要求。",rows:3},null,8,["modelValue"])])),_:1}),T(V,{label:"上传附件",prop:"updateFile"},{default:q((()=>[T(n,{ref_key:"upload",ref:se,modelValue:de.value.updateFile,"onUpdate:modelValue":a[7]||(a[7]=e=>de.value.updateFile=e),site:"dmp_attach",onChange:me,onError:ve,onSuccess:ye},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])),[[_e,k.value]])])),_:1},8,["modelValue"])])),[[_e,m.value]])}}}))));var se,de=m(ue,[["__scopeId","data-v-40e94cb0"]]);export{de as default};
