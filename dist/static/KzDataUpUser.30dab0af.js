import{K as e}from"./KzUpload.d3e80b16.js";import{K as a,e as l,X as s}from"./index.743440f4.js";import{a as u}from"./myData.623e6042.js";import{H as r,u as t,ay as o,j as d,g as p,C as n,b as i,ae as m,o as c,c as v,w as g,J as f,a as b,_ as h,B as V,k as x,a1 as y}from"./vue.fa004e33.js";const _=f("div",{class:"up-user-title"},"上传客户",-1),w={class:"dialog-footer"},F=y("取消"),k=y("上传"),U=r({props:{modelValue:{type:Boolean}},emits:["update:modelValue","submitSuccess"],setup(r,{emit:y}){const U=r,q=t({get:()=>U.modelValue,set:e=>{y("update:modelValue",e)}}),D=o(),j=d({personsName:[{required:!0,message:"请输入人群名称",trigger:"change"},{required:!0,message:"请输入人群名称",trigger:"blur"}],personsDesc:[{required:!0,message:"请输入人群描述",trigger:"change"},{required:!0,message:"请输入人群描述",trigger:"blur"}],updateFile:[{required:!0,message:"请添加文件",trigger:"blur"},{validator:(e,a,l)=>{switch(C.value){case"size":l(new Error("请添加大小不超过4M的文件"));break;case"type":l(new Error("请添加 .doc、.docx、.pdf、.xls、.xlsx 格式的文件"));break;case"none":l(new Error("请添加文件"));break;default:l()}},trigger:"change"}]}),C=p("none"),N=p(),E=p(),K=p({personsName:"",personsDesc:"",updateFile:""}),L=p(!1),M=p("");n((()=>{const e="/product/dmp/mydata/up2b"===D.path?"/dmp/source/template/download.do?type=1":"/dmp/source/template/download.do?type=2";a({url:e,method:"get",headers:{"Content-Type":"application/json;charset=UTF-8",MODULE:"dmp"},responseType:"blob"}).then((e=>{M.value=URL.createObjectURL(e.data)}))}));const R=()=>{L.value=!1,C.value="none",E.value.clear(),N.value.resetFields(),y("update:modelValue",!1)},S=()=>{N.value.validate((e=>{if(!e)return!1;L.value=!0,E.value.submit()}))},T=e=>{e?(C.value=e,K.value.updateFile="",N.value.validateField("file",(()=>null))):(C.value="",N.value.clearValidate("updateFile"))},z=e=>{K.value.updateFile="",C.value="none",E.value.clear(),L.value=!1,l("上传失败")},B=e=>{L.value=!1,u({attachment:e,group_desc:K.value.personsDesc,group_name:K.value.personsName,type:"/product/dmp/mydata/up2b"===D.path?1:2}).then((e=>{e.status?(R(),N.value.resetFields(),y("submitSuccess",1)):(K.value.updateFile="",C.value="none",E.value.clear()),L.value=!1})).catch((()=>{z()}))},O=e=>{L.value?s().then((()=>{e()})).catch((()=>{})):e()};return(a,l)=>{const s=i("el-input"),u=i("el-form-item"),r=i("el-form"),t=i("el-button"),o=i("el-dialog"),d=m("loading");return c(),v(o,{modelValue:V(q),"onUpdate:modelValue":l[3]||(l[3]=e=>x(q)?q.value=e:null),width:500,draggable:"","before-close":O,onClose:R},{title:g((()=>[_])),footer:g((()=>[f("span",w,[b(t,{disabled:L.value,onClick:R},{default:g((()=>[F])),_:1},8,["disabled"]),b(t,{type:"primary",disabled:L.value,onClick:S},{default:g((()=>[k])),_:1},8,["disabled"])])])),default:g((()=>[h((c(),v(r,{ref_key:"formRef",ref:N,model:K.value,rules:V(j),"label-width":"80px"},{default:g((()=>[b(u,{label:"人群名称",required:"",prop:"personsName"},{default:g((()=>[b(s,{modelValue:K.value.personsName,"onUpdate:modelValue":l[0]||(l[0]=e=>K.value.personsName=e),placeholder:"请输入人群名称",clearable:""},null,8,["modelValue"])])),_:1}),b(u,{label:"人群描述",required:"",prop:"personsDesc"},{default:g((()=>[b(s,{modelValue:K.value.personsDesc,"onUpdate:modelValue":l[1]||(l[1]=e=>K.value.personsDesc=e),type:"textarea",maxlength:"150","show-word-limit":"",class:"input-textarea",placeholder:"请对人群进行简单的描述"},null,8,["modelValue"])])),_:1}),b(u,{label:"文件上传",prop:"updateFile",required:""},{default:g((()=>[b(e,{ref_key:"upload",ref:E,modelValue:K.value.updateFile,"onUpdate:modelValue":l[2]||(l[2]=e=>K.value.updateFile=e),site:"dmp_excel","down-link":M.value,"exname-list":[".doc",".docx",".pdf",".xls",".xlsx"],msg:"数据文件大小不超过2M",onChange:T,onError:z,onSuccess:B},null,8,["modelValue","down-link","exname-list"])])),_:1})])),_:1},8,["model","rules"])),[[d,L.value]])])),_:1},8,["modelValue"])}}});export{U as _};
