var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,s=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t;import{f as d}from"./date.23847c74.js";import{K as o}from"./KzEmpty.b11d49f7.js";import{K as i}from"./KzPage.9c6d1927.js";import{K as n}from"./KzUpload.e32ad148.js";import{K as p}from"./KzDmpTitle.75aa6a30.js";import{_ as c,m,C as v,T as y,W as f,E as b,e as _,Y as g}from"./index.561f5261.js";import{_ as h}from"./KzCascader.6a65f304.js";import{H as k,u as w,g as V,j,$ as x,o as C,I as F,J as z,a as T,w as q,B as K,a3 as O,X as U,c as P,a1 as E,P as B,aa as D,a2 as I,ax as M,r as H,ad as N}from"./vue.a499711c.js";import{o as S,a as $,b as A}from"./seekAbroad.7f2a93bf.js";import"./tinymce.275386ab.js";const J={class:"kz_card dmp_page"},L={class:"fsc mb20"},R=I("新增需求"),W={class:"dmp_table"},X={class:"fcs"},Y={class:"fcs"},G=I("详情"),Q=I("---"),Z=I("驳回原因"),ee={key:3,class:"line"},ae=I("删除"),le={class:"flexr"},te=I("取消"),re=I("确认"),ue=k((se=((e,a)=>{for(var l in a||(a={}))r.call(a,l)&&s(e,l,a[l]);if(t)for(var l of t(a))u.call(a,l)&&s(e,l,a[l]);return e})({},{name:"Buyer"}),a(se,l({setup(e){const a=m(),l=w((()=>a.state.typeHash)),t=w((()=>a.state.countryList)),r=V(0),u=V(10),s=V(1);M();const c=V(!1),k=V(!1),I=V(!1),ue=V(),se=V(),de=V({industryType:[],country:"",name:"",desc:"",updateFile:""}),oe=V(),ie=V([]),ne=j({industryType:[{required:!0,message:"请选择行业分类",trigger:"blur"}],country:[{required:!0,message:"请选择地区",trigger:"blur"},{required:!0,message:"请选择地区",trigger:"change"}],name:[{required:!0,message:"请输入供应商品",trigger:"change"},{required:!0,message:"请输入供应商品",trigger:"blur"}],desc:[{required:!0,message:"请输入描述",trigger:"change"},{required:!0,message:"请输入描述",trigger:"blur"}],updateFile:[{validator:(e,a,l)=>{switch(oe.value){case"size":l(new Error("请添加大小不超过4M的文件"));break;case"type":l(new Error("请添加 .doc、.docx、.pdf、.xls、.xlsx 格式的文件"));break;default:l()}},trigger:"change"}]}),pe=async()=>{c.value=!0;const e={current:s.value,type:1,size:u.value},{status:a,body:l}=await S(e);c.value=!1,a&&(r.value=l.total,ie.value=l.records)};pe();const ce=()=>{ue.value.validate((e=>{if(!e)return!1;k.value=!0,de.value.updateFile?se.value.submit():ye()}))},me=e=>{e?(oe.value=e,de.value.updateFile="",ue.value.validateField("updateFile",(()=>null))):(oe.value="",ue.value.clearValidate("updateFile"))},ve=e=>{de.value.updateFile="",oe.value="none",se.value.clear(),k.value=!1,_("上传失败")},ye=e=>{A({attachment:e||"",demand_desc:de.value.desc,product_name:de.value.name,type:1,country_id:de.value.country,industry_id:de.value.industryType.join(",")}).then((e=>{e.status?(I.value=!1,ue.value.resetFields(),s.value=1,pe()):(de.value.updateFile="",se.value.clear()),k.value=!1})).catch((()=>{k.value=!1,ve()}))},fe=()=>{k.value=!1,oe.value="none",se.value.clear(),ue.value.resetFields()},be=e=>{k.value?g().then((()=>{e()})).catch((()=>{})):e()};return(e,a)=>{const m=H("el-button"),_=H("el-table-column"),g=H("el-link"),w=H("el-table"),V=H("el-form-item"),j=H("el-option"),M=H("el-select"),S=H("el-input"),A=H("el-form"),oe=H("el-dialog"),_e=N("loading");return x((C(),F("div",J,[z("div",L,[T(p),T(m,{type:"primary",icon:K(v),onClick:a[0]||(a[0]=e=>I.value=!0)},{default:q((()=>[R])),_:1},8,["icon"])]),z("div",W,[T(w,{data:ie.value},{empty:q((()=>[T(o)])),default:q((()=>[T(_,{type:"selection",width:"50"}),T(_,{property:"id",label:"ID"}),T(_,{property:"industry_id",label:"行业分类"},{default:q((e=>[z("div",null,O(K(y)(e.row.industry_id.split(","),K(l),"last")),1)])),_:1}),T(_,{property:"country_id",label:"地区"}),T(_,{property:"product_name",label:"供应商品"}),T(_,{property:"demand_desc",label:"描述"}),T(_,{property:"create_time",label:"发起时间"},{default:q((({row:e})=>[z("div",null,O(K(d)(new Date(Number(e.create_time)),"yyyy-MM-dd")),1)])),_:1}),T(_,{property:"status",label:"状态"},{default:q((({row:e})=>[z("div",X,[z("div",{class:U(["status_dot",K(f)(e.status).className])},null,2),z("div",null,O(K(f)(e.status).text),1)])])),_:1}),T(_,{property:"user_name",label:"创建人"}),T(_,{label:"操作",width:"300"},{default:q((({row:a})=>[z("div",Y,[4===a.status?(C(),P(g,{key:0,type:"primary",onClick:l=>e.$router.push("/product/dmp/seekabroad/buyerdetails?id="+a.id)},{default:q((()=>[G])),_:2},1032,["onClick"])):E("",!0),2===a.status?(C(),P(g,{key:1,type:"primary"},{default:q((()=>[Q])),_:1})):E("",!0),3===a.status?(C(),P(g,{key:2,type:"primary",onClick:e=>(e=>{b.alert(e.fail_reason||"暂没有驳回原因，请联系管理员","驳回原因",{confirmButtonText:"确认"})})(a)},{default:q((()=>[Z])),_:2},1032,["onClick"])):E("",!0),2!==a.status&&1!==a.status?(C(),F("div",ee)):E("",!0),2!==a.status?(C(),P(g,{key:4,type:"primary",onClick:e=>(e=>{b.confirm("是否确认删除?","操作提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((async()=>{const a={id:e.id},{status:l}=await $(a);l&&pe()}))})(a)},{default:q((()=>[ae])),_:2},1032,["onClick"])):E("",!0)])])),_:1})])),_:1},8,["data"])]),T(i,{page:s.value,"onUpdate:page":a[1]||(a[1]=e=>s.value=e),size:u.value,"onUpdate:size":a[2]||(a[2]=e=>u.value=e),total:r.value,onChange:pe},null,8,["page","size","total"]),T(oe,{modelValue:I.value,"onUpdate:modelValue":a[9]||(a[9]=e=>I.value=e),width:500,draggable:"",title:"添加需求","before-close":be,onClose:fe},{footer:q((()=>[z("div",le,[T(m,{disabled:k.value,onClick:a[8]||(a[8]=e=>I.value=!1)},{default:q((()=>[te])),_:1},8,["disabled"]),T(m,{type:"primary",disabled:k.value,onClick:ce},{default:q((()=>[re])),_:1},8,["disabled"])])])),default:q((()=>[x((C(),P(A,{ref_key:"formRef",ref:ue,model:de.value,rules:ne,"label-width":"80px"},{default:q((()=>[T(V,{label:"行业分类",required:"",prop:"industryType"},{default:q((()=>[T(h,{modelValue:de.value.industryType,"onUpdate:modelValue":a[3]||(a[3]=e=>de.value.industryType=e),type:"type"},null,8,["modelValue"])])),_:1}),T(V,{label:"选择地区",prop:"country"},{default:q((()=>[T(M,{modelValue:de.value.country,"onUpdate:modelValue":a[4]||(a[4]=e=>de.value.country=e),placeholder:"请选择地区",clearable:"",class:"f1"},{default:q((()=>[(C(!0),F(B,null,D(K(t),(e=>(C(),P(j,{key:e.code,label:e.country_name,value:e.code},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),T(V,{label:"采购产品",required:"",prop:"name"},{default:q((()=>[T(S,{modelValue:de.value.name,"onUpdate:modelValue":a[5]||(a[5]=e=>de.value.name=e),placeholder:"请输入产品名称",clearable:""},null,8,["modelValue"])])),_:1}),T(V,{label:"需求描述",required:"",prop:"desc"},{default:q((()=>[T(S,{modelValue:de.value.desc,"onUpdate:modelValue":a[6]||(a[6]=e=>de.value.desc=e),type:"textarea",maxlength:"150","show-word-limit":"",class:"input_textarea",placeholder:"可简要描述对寻找地区的采购服务商的要求。",rows:3},null,8,["modelValue"])])),_:1}),T(V,{label:"上传附件",prop:"updateFile"},{default:q((()=>[T(n,{ref_key:"upload",ref:se,modelValue:de.value.updateFile,"onUpdate:modelValue":a[7]||(a[7]=e=>de.value.updateFile=e),site:"dmp_attach",onChange:me,onError:ve,onSuccess:ye},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])),[[_e,k.value]])])),_:1},8,["modelValue"])])),[[_e,c.value]])}}}))));var se,de=c(ue,[["__scopeId","data-v-32300342"]]);export{de as default};
