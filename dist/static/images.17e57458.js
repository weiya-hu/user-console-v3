var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,i=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t;import{f as o}from"./date.23847c74.js";import{_ as n,U as r,B as d,o as c,e as m,H as v,I as p}from"./index.20de6183.js";import{K as f}from"./KzEmpty.f9053af9.js";import{K as y}from"./KzPage.4594f013.js";import{K as _}from"./KzDialog.9ac52faf.js";import{i as b,f as h,g,h as w}from"./myWork.93066312.js";import{H as k,g as j,o as C,I as x,J as O,a as P,w as V,a2 as z,B as I,W as K,_ as U,c as E,a0 as S,av as G,aw as D,a1 as J,b as M,ae as N}from"./vue.fa004e33.js";import"./tinymce.50e98bcc.js";import"./kzkf.83b11867.js";const q=e=>(G("data-v-2e53134d"),e=e(),D(),e),B={class:"m_images"},F={class:"article_top flexb"},H=q((()=>O("div",null,"图片库",-1))),R=J("新建"),W={class:"dmp_table"},A=["src","onClick"],T={class:"els"},L={class:"fcs"},Q={class:"els"},X={key:0,class:"fcs"},Y=J("修改名称"),Z=q((()=>O("div",{class:"line"},null,-1))),$=J("删除"),ee=q((()=>O("div",{class:"line"},null,-1))),ae=J("驳回原因"),le={key:1,class:"fcs"},te=J("修改名称"),se=q((()=>O("div",{class:"line"},null,-1))),ue=J("删除"),ie=q((()=>O("div",{class:"line"},null,-1))),oe=J("查看"),ne={class:"add_img_content"},re={class:"fc fcc"},de=q((()=>O("div",{class:"file_name"},"点击上传",-1))),ce=q((()=>O("div",{class:"tips"}," 图片尺寸16:9，建议尺寸：220*160≤尺寸≤1920*890；支持JPG、PNG 、JPEG等格式；一次最多上传9张 ",-1))),me={class:"fcs btns fjend"},ve=J("取消"),pe=J("提交"),fe={class:"flex fjend"},ye=J("确定"),_e=k((be=((e,a)=>{for(var l in a||(a={}))s.call(a,l)&&i(e,l,a[l]);if(t)for(var l of t(a))u.call(a,l)&&i(e,l,a[l]);return e})({},{name:"我的作品库-图片库"}),a(be,l({setup(e){const a=j(1),l=j(0),t=j(10),s=j([]),u=async()=>{const e=await b({size:t.value,current:a.value});1==e.status&&(s.value=e.body.records,l.value=e.body.total)};u();const i=()=>{u()},n=j([]),k=e=>{n.value=e},G=j(""),D=j(!1),J=e=>{G.value=e,D.value=!0},q=async()=>{1==(await h({id:G.value})).status&&u(),D.value=!1},_e=j([]),be=j(!1),he=j(0),ge=e=>{const a=[];s.value.forEach((e=>{a.push(e.thumb_url)})),_e.value=a,he.value=_e.value.findIndex((a=>a==e)),be.value=!0},we=j(!1),ke=j(""),je=j(!1),Ce=j(!1),xe=j([]),Oe=j();let Pe=[];const Ve=()=>{Oe.value.clearFiles(),je.value=!1,Ce.value=!1,xe.value=[],_e.value=[],be.value=!1,he.value=0,Pe=[]},ze=async e=>{const a=await v({site:"cms_image"});if(1==a.status){const l=e.name.substring(e.name.lastIndexOf(".")),t=e.name.substring(0,e.name.indexOf(".")),s=new FormData,u={key:a.body.dir+"/"+a.body.uuid+l,OSSAccessKeyId:a.body.accessid,success_action_status:200,policy:a.body.policy,signature:a.body.signature};for(const[e,a]of Object.entries(u))s.append(e,a);if(s.append("file",e.raw),200==(await p({url:a.body.host,method:"post",headers:{"Content-Type":"multipart/form-data;"},data:s})).status){const e=a.body.host+"/"+a.body.dir+"/"+a.body.uuid+l;if(Pe.push(e),1==(await w({thumb_url:e,source_name:t.slice(0,30)})).status)return Promise.resolve(e)}return Promise.reject(e.name+"上传失败")}return Promise.reject("获取上传配置失败")},Ie=async()=>{Ce.value=!0;try{for(let e=0;e<xe.value.length;e++){const a=xe.value[e];if(await ze(a).catch((e=>{throw new Error(e)})),Pe.length==xe.value.length){c("上传成功"),Ve(),u();break}}}catch(e){m(e,0),Ve(),u()}},Ke=[".jpg",".png",".jpeg",".JPG",".PNG",".JPEG"],Ue=(e,a)=>{const l=e.name.substring(e.name.lastIndexOf("."));return-1==Ke.indexOf(l)?(Oe.value.handleRemove(e),void m("图片格式错误！")):e.size&&e.size/1024/1024>10?(Oe.value.handleRemove(e),void m("图片文件大小不能超过10M")):(xe.value=a,void(xe.value.length>=9&&(document.querySelector(".el-upload--picture-card").style.display="none")))},Ee=(e,a)=>{xe.value=a,document.querySelector(".el-upload--picture-card").style.display="inline-flex"},Se=e=>{const a=[];xe.value.forEach((e=>{a.push(e.url)})),_e.value=a,he.value=_e.value.findIndex((a=>a==e.url)),be.value=!0},Ge=j(!1),De=j(""),Je=j(""),Me=(e,a)=>{De.value=e,Je.value=a,Ge.value=!0},Ne=async()=>{const{status:e}=await g({id:De.value,source_name:Je.value});1==e&&(Ge.value=!1,u())};return(e,u)=>{const n=M("KzIcon"),c=M("el-button"),m=M("el-table-column"),v=M("el-link"),p=M("el-table"),b=M("el-icon"),h=M("el-upload"),g=M("el-dialog"),w=M("el-input"),j=M("el-form-item"),G=M("el-form"),Pe=M("el-image-viewer"),ze=N("loading");return C(),x("div",B,[O("div",F,[H,O("div",null,[P(c,{type:"primary",class:"add_need_btn",onClick:u[0]||(u[0]=e=>je.value=!0)},{default:V((()=>[P(n,{href:"#icon-tianjia",size:"14px",color:"white",class:"add_need_icon"}),R])),_:1})])]),O("div",W,[P(p,{data:s.value,style:{width:"100%"},onSelectionChange:k},{empty:V((()=>[P(f)])),default:V((()=>[P(m,{type:"selection",width:"50"}),P(m,{property:"id",label:"ID","min-width":"150"}),P(m,{property:"thumb_url",label:"图片","min-width":"150"},{default:V((({row:e})=>[O("img",{src:e.thumb_url,alt:"",class:"firstimg lookhover",onClick:a=>ge(e.thumb_url)},null,8,A)])),_:1}),P(m,{property:"source_name",label:"图片名","min-width":"150"},{default:V((({row:e})=>[O("div",T,z(e.source_name),1)])),_:1}),P(m,{property:"create_time",label:"创建日期","min-width":"150"},{default:V((({row:e})=>[O("div",null,z(I(o)(new Date(e.create_time),"yyyy-MM-dd")),1)])),_:1}),P(m,{property:"status",label:"状态","min-width":"120"},{default:V((({row:e})=>[O("div",L,[O("div",{class:K(["status_dot",I(r)(e.status).className])},null,2),O("div",null,z(I(r)(e.status).text),1)])])),_:1}),P(m,{property:"user_name",label:"创作人","min-width":"120"},{default:V((({row:e})=>[O("div",Q,z(e.user_name),1)])),_:1}),P(m,{label:"操作",fixed:"right",width:"240"},{default:V((({row:e})=>[4==e.status?(C(),x("div",X,[P(v,{type:"primary",onClick:a=>Me(e.id,e.source_name)},{default:V((()=>[Y])),_:2},1032,["onClick"]),Z,P(v,{type:"primary",onClick:a=>J(e.id)},{default:V((()=>[$])),_:2},1032,["onClick"]),ee,P(v,{type:"primary",onClick:()=>{ke.value=e.fail_reason,we.value=!0}},{default:V((()=>[ae])),_:2},1032,["onClick"])])):(C(),x("div",le,[P(v,{type:"primary",onClick:a=>Me(e.id,e.source_name)},{default:V((()=>[te])),_:2},1032,["onClick"]),se,P(v,{type:"primary",onClick:a=>J(e.id)},{default:V((()=>[ue])),_:2},1032,["onClick"]),ie,P(v,{type:"primary",onClick:a=>ge(e.thumb_url)},{default:V((()=>[oe])),_:2},1032,["onClick"])]))])),_:1})])),_:1},8,["data"])]),P(y,{page:a.value,"onUpdate:page":u[1]||(u[1]=e=>a.value=e),size:t.value,"onUpdate:size":u[2]||(u[2]=e=>t.value=e),total:l.value,onChange:i},null,8,["page","size","total"]),P(_,{modelValue:D.value,"onUpdate:modelValue":u[3]||(u[3]=e=>D.value=e),msg:"确认删除这条数据吗?",onSure:q},null,8,["modelValue"]),P(_,{modelValue:we.value,"onUpdate:modelValue":u[4]||(u[4]=e=>we.value=e),msg:ke.value,title:"驳回原因",btn:1},null,8,["modelValue","msg"]),P(g,{modelValue:je.value,"onUpdate:modelValue":u[5]||(u[5]=e=>je.value=e),title:"上传图片",width:"400px","custom-class":"upimgs",onClose:Ve},{default:V((()=>[U((C(),x("div",ne,[P(h,{ref_key:"upload",ref:Oe,action:"#","auto-upload":!1,limit:9,multiple:!0,"list-type":"picture-card","on-change":Ue,"on-preview":Se,"on-remove":Ee,accept:Ke.join(","),class:"upbox"},{default:V((()=>[O("div",re,[P(b,null,{default:V((()=>[P(I(d))])),_:1}),de])])),_:1},8,["accept"]),ce,O("div",me,[P(c,{onClick:Ve},{default:V((()=>[ve])),_:1}),P(c,{type:"primary",disabled:!xe.value.length,onClick:Ie},{default:V((()=>[pe])),_:1},8,["disabled"])])])),[[ze,Ce.value]])])),_:1},8,["modelValue"]),P(g,{modelValue:Ge.value,"onUpdate:modelValue":u[7]||(u[7]=e=>Ge.value=e),title:"修改名称",width:"380px"},{default:V((()=>[P(G,null,{default:V((()=>[P(j,{label:"输入名称"},{default:V((()=>[P(w,{modelValue:Je.value,"onUpdate:modelValue":u[6]||(u[6]=e=>Je.value=e),placeholder:"请输入名称"},null,8,["modelValue"])])),_:1})])),_:1}),O("div",fe,[P(c,{type:"primary",disabled:!Je.value,onClick:Ne},{default:V((()=>[ye])),_:1},8,["disabled"])])])),_:1},8,["modelValue"]),be.value?(C(),E(Pe,{key:0,"url-list":_e.value,"initial-index":he.value,onClose:u[8]||(u[8]=e=>be.value=!1)},null,8,["url-list","initial-index"])):S("",!0)])}}}))));var be,he=n(_e,[["__scopeId","data-v-2e53134d"]]);export{he as default};
