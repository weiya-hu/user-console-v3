import{K as e}from"./KzIphonePreview.ea99fa03.js";import{H as a,g as l,u as t,o as s,I as u,J as n,a2 as d,B as o,a as i,w as r,P as c,aa as v,k as m,a1 as p,av as f,aw as g,ax as b,ay as y,b as _,c as h}from"./vue.fa004e33.js";import{d as V,c as k,j as w,k as x,l as j}from"./message.d0315a76.js";import{K as z}from"./KzDialog.df5ada75.js";import{_ as q}from"./index.743440f4.js";import{w as C}from"./warning.672ed23a.js";import"./kzkf.70bb183f.js";import"./tinymce.50e98bcc.js";const T=e=>(f("data-v-534d40f8"),e=e(),g(),e),U={class:"add_template flex"},P={class:"kz_card lt"},F={class:"card_title fsc"},K={class:"fcs"},I=p(" 取消 "),B=p("稍后编辑"),E=p(" 提交 "),R=p("新建签名"),S={class:"f1"},D={class:"tip fcs mb16"},H=p("“付款”、“现金”为敏感词，容易导致模板审核失败，或被运营商拦截，请注意修改 "),J={class:"flex"},N={style:{"margin-left":"12px"}},$=p("插入变量"),A={class:"mt16"},G=p("插入短链"),L={class:"content_info"},M={class:"kz_card rt fs0"},O=T((()=>n("div",{class:"card_title"},"短信预览",-1)));var Q=q(a({setup(a){const f=l(!1),g=l(),q=l({name:""}),T=l({name:[{required:!0,message:"请输入签名",trigger:"change"},{validator:(e,a,l)=>{a.length<2?l(new Error("签名字数需在2~10之间")):l()},trigger:"blur"}]}),Q=()=>{g.value.validate((async e=>{if(e){const{status:e}=await V(q.value);e&&(g.value.resetFields(),f.value=!1,ue.value=1,ie())}}))},W=b(),X=y(),Y=X.query.id?String(X.query.id):"",Z=l(""),ee=t((()=>(le.value.sign?"【"+Z.value+"】":"")+le.value.content)),ae=l(),le=l({smsType:1,name:"",sign:"",content:""}),te={smsType:[{required:!0,message:"请选择短信类型！",trigger:"change"}],name:[{required:!0,message:"请输入模板名称！",trigger:"change"}],sign:[{required:!0,message:"请选择签名！",trigger:"change"}],content:[{required:!0,message:"请输入模板内容！",trigger:"change"}]},se=[{label:"事务类",value:1},{label:"通用/运营类",value:2}],ue=l(1),ne=l(5),de=l(0),oe=l([]),ie=async()=>{const{status:e,body:a}=await k({size:ne.value,current:ue.value});e&&(de.value=a.total,oe.value=a.records)},re=e=>{var a;Z.value=null==(a=oe.value.find((a=>a.id===e)))?void 0:a.name},ce=()=>{ie()},ve=l(0),me=e=>{ve.value=e,e?ae.value.validate((async e=>{if(e){const{status:e}=await w({content:le.value.content,signature_id:le.value.sign,title:le.value.name,type:le.value.smsType,id:Y});e&&W.back()}})):ae.value.validateField("name",(async e=>{if(e){const{status:e}=await x({content:le.value.content,signature_id:le.value.sign,title:le.value.name,type:le.value.smsType,id:Y});e&&W.back()}}))};return(async()=>{await ie(),Y&&j({id:Y}).then((async e=>{le.value.smsType=e.body.type,le.value.name=e.body.title,le.value.sign=e.body.signature_id,le.value.content=e.body.content;const a=async()=>{const l=oe.value.find((a=>a.id===Number(e.body.signature_id)));Z.value=l?l.name:"",l||ue.value*ne.value>=de.value||(ue.value++,await ie(),a())};await a()}))})(),(a,l)=>{const t=_("el-button"),b=_("el-radio"),y=_("el-radio-group"),V=_("el-form-item"),k=_("el-input"),w=_("el-option"),x=_("el-pagination"),j=_("el-select"),W=_("el-icon"),X=_("el-form");return s(),u("div",U,[n("div",P,[n("div",F,[n("div",null,d(o(Y)?"编辑":"新建")+"模板",1),n("div",K,[i(t,{class:"bdc_btn",onClick:a.$router.back},{default:r((()=>[I])),_:1},8,["onClick"]),i(t,{class:"bdc_btn",onClick:l[0]||(l[0]=e=>me(0))},{default:r((()=>[B])),_:1}),i(t,{type:"primary",onClick:l[1]||(l[1]=e=>me(1))},{default:r((()=>[E])),_:1})])]),i(X,{ref_key:"addFormRef",ref:ae,model:le.value,rules:te,"hide-required-asterisk":"",class:"add_form"},{default:r((()=>[i(V,{label:"短信类型",prop:"smsType"},{default:r((()=>[i(y,{modelValue:le.value.smsType,"onUpdate:modelValue":l[2]||(l[2]=e=>le.value.smsType=e)},{default:r((()=>[(s(),u(c,null,v(se,(e=>i(b,{key:e.label,label:e.value},{default:r((()=>[p(d(e.label),1)])),_:2},1032,["label"]))),64))])),_:1},8,["modelValue"])])),_:1}),i(V,{label:"模板名称",prop:"name"},{default:r((()=>[i(k,{modelValue:le.value.name,"onUpdate:modelValue":l[3]||(l[3]=e=>le.value.name=e),placeholder:"请输入模板名称"},null,8,["modelValue"])])),_:1}),i(V,{label:"插入签名",prop:"sign"},{default:r((()=>[i(j,{modelValue:le.value.sign,"onUpdate:modelValue":l[5]||(l[5]=e=>le.value.sign=e),placeholder:"请选择签名",class:"f1",onChange:re},{default:r((()=>[(s(!0),u(c,null,v(oe.value,(e=>(s(),h(w,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128)),i(x,{currentPage:ue.value,"onUpdate:currentPage":l[4]||(l[4]=e=>ue.value=e),layout:"prev, pager, next",total:de.value,"page-size":ne.value,small:"",onCurrentChange:ce},null,8,["currentPage","total","page-size"])])),_:1},8,["modelValue"]),i(t,{class:"bdc_btn",style:{"margin-left":"12px"},onClick:l[6]||(l[6]=e=>f.value=!0)},{default:r((()=>[R])),_:1})])),_:1}),i(V,{label:"模板内容",prop:"content"},{default:r((()=>[n("div",S,[n("div",D,[i(W,{color:"#FE9B25",size:"14px",style:{"margin-right":"8px"}},{default:r((()=>[i(o(C))])),_:1}),H]),n("div",J,[i(k,{modelValue:le.value.content,"onUpdate:modelValue":l[7]||(l[7]=e=>le.value.content=e),rows:6,type:"textarea",placeholder:"请输入模板内容",maxlength:500,class:"f1"},null,8,["modelValue"]),n("div",N,[n("div",null,[i(t,{class:"bdc_btn",disabled:""},{default:r((()=>[$])),_:1})]),n("div",A,[i(t,{class:"bdc_btn",disabled:""},{default:r((()=>[G])),_:1})])])]),n("div",L,"已输入 "+d(le.value.content.length)+" 字符，按 1 条计费",1)])])),_:1})])),_:1},8,["model"])]),n("div",M,[O,i(e,{modelValue:o(ee),"onUpdate:modelValue":l[8]||(l[8]=e=>m(ee)?ee.value=e:null)},null,8,["modelValue"])]),i(z,{modelValue:f.value,"onUpdate:modelValue":l[10]||(l[10]=e=>f.value=e),width:"470px",title:"新建签名",onSure:Q},{default:r((()=>[i(X,{ref_key:"formRef",ref:g,model:q.value,rules:T.value},{default:r((()=>[i(V,{label:"签名标题",prop:"name"},{default:r((()=>[i(k,{modelValue:q.value.name,"onUpdate:modelValue":l[9]||(l[9]=e=>q.value.name=e),placeholder:"请输入签名",maxlength:10,minlength:2},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-534d40f8"]]);export{Q as default};
