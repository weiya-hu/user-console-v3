import{f as e}from"./date.23847c74.js";import{K as a}from"./KzEmpty.61a513e5.js";import{K as l}from"./KzPage.9312e74c.js";import{m as t,A as u,P as r,Q as d,S as s,e as o}from"./index.7f252a0e.js";import{c as i,a as p,b as n}from"./seekPathPro.ed0df80c.js";import{K as c}from"./KzDmpTitle.1b8d0ed8.js";import{K as m}from"./KzDialog.afc18edb.js";import{K as v}from"./KzUpload.7b5bb174.js";import{_ as y}from"./KzCascader.6fd21cdd.js";import{H as f,g,u as _,j as b,o as h,I as w,J as k,a as V,w as x,B as j,$ as z,c as F,a3 as C,X as K,a1 as U,a2 as q,r as T,ad as E}from"./vue.a499711c.js";import"./tinymce.275386ab.js";const P={class:"kz_card dmp_page"},D={class:"fsc mb20"},H=q("新增需求"),M={class:"dmp_table"},S={style:{width:"100px"}},I={class:"els"},N={style:{width:"100px"},class:"fcc"},$={class:"els2"},A={style:{width:"100px"},class:"fcc"},B={class:"els2"},J={class:"fcs"},Q={class:"fcs"},R=q("详情"),X=q("---"),G=q("驳回原因"),L=q("下载附件"),O={key:4,class:"line"},W=q("删除"),Y={class:"flexr"},Z=q("取消"),ee=q("确认"),ae=f({name:"seekPath",setup(f){const q=t(),ae=g(q.state.addressHash),le=_((()=>q.state.typeHash)),te=g([]),ue=g(0),re=g(10),de=g(1),se=g(!1),oe=async()=>{se.value=!0;const e={current:de.value,type:1,size:re.value},{status:a,body:l}=await i(e);se.value=!1,a&&(ue.value=l.total,te.value=l.records)};oe();const ie=g(!1),pe=g(""),ne=g(!1),ce=g(""),me=async()=>{const{status:e}=await p({id:ce.value});1===e&&(ne.value=!1,oe())},ve=g(!1),ye=g(!1),fe=g(),ge=g(),_e=g({industryType:[],country:[],name:"",desc:"",updateFile:""}),be=g(),he=b({industryType:[{required:!0,message:"请选择行业分类",trigger:"blur"}],country:[{required:!0,message:"请选择地区",trigger:"blur"}],name:[{required:!0,message:"请输入渠道名称",trigger:"change"},{required:!0,message:"请输入渠道名称",trigger:"blur"}],desc:[{required:!0,message:"请输入渠道描述",trigger:"change"},{required:!0,message:"请输入渠道描述",trigger:"blur"}],updateFile:[{validator:(e,a,l)=>{switch(be.value){case"size":l(new Error("请添加大小不超过4M的文件"));break;case"type":l(new Error("请添加 .doc、.docx、.pdf、.xls、.xlsx 格式的文件"));break;case"none":l(new Error("请添加文件"));break;default:l()}},trigger:"change"}]}),we=e=>{e?(be.value=e,_e.value.updateFile="",fe.value.validateField("updateFile",(()=>null))):(be.value="",fe.value.clearValidate("updateFile"))},ke=e=>{_e.value.updateFile="",be.value="none",ge.value.clear(),ve.value=!1,o("上传失败")},Ve=e=>{n({attachment:e||"",group_desc:_e.value.desc,group_name:_e.value.name,type:1,province:_e.value.country[0],city:_e.value.country[1],district:_e.value.country[2],industry_id:_e.value.industryType.join(",")}).then((e=>{e.status?(ye.value=!1,fe.value.resetFields(),de.value=1,oe()):(_e.value.updateFile="",ge.value.clear()),ve.value=!1})).catch((()=>{ve.value=!1,ke()}))},xe=()=>{fe.value.validate((e=>{if(!e)return!1;ve.value=!0,_e.value.updateFile?ge.value.submit():Ve()}))};return(t,o)=>{const i=T("el-button"),p=T("el-table-column"),n=T("el-tooltip"),f=T("el-link"),g=T("el-table"),_=T("el-form-item"),b=T("el-input"),q=T("el-form"),be=T("el-dialog"),je=E("loading");return h(),w("div",P,[k("div",D,[V(c),V(i,{type:"primary",icon:j(u),onClick:o[0]||(o[0]=e=>ye.value=!0)},{default:x((()=>[H])),_:1},8,["icon"])]),k("div",M,[z((h(),F(g,{data:te.value,size:"large"},{empty:x((()=>[V(a)])),default:x((()=>[V(p,{type:"selection",width:"50"}),V(p,{property:"id",label:"ID"}),V(p,{property:"type",label:"行业分类",width:"150"},{default:x((e=>[k("div",null,C(j(r)(e.row.industry_id.split(","),j(le),"last")),1)])),_:1}),V(p,{label:"地区",width:"180"},{default:x((({row:e})=>[V(n,{effect:"dark",placement:"top"},{content:x((()=>[k("div",S,C(e.province>0&&j(r)(j(d)(e.province,e.city,e.district),ae.value)),1)])),default:x((()=>[k("div",I,C(e.province>0&&j(r)(j(d)(e.province,e.city,e.district),ae.value)),1)])),_:2},1024)])),_:1}),V(p,{property:"group_name",label:"渠道名称",width:"200"},{default:x((({row:e})=>[V(n,{effect:"dark",placement:"top"},{content:x((()=>[k("div",N,C(e.group_name),1)])),default:x((()=>[k("div",$,C(e.group_name),1)])),_:2},1024)])),_:1}),V(p,{property:"group_desc",label:"渠道描述",width:"300"},{default:x((({row:e})=>[V(n,{effect:"dark",placement:"top"},{content:x((()=>[k("div",A,C(e.group_name),1)])),default:x((()=>[k("div",B,C(e.group_name),1)])),_:2},1024)])),_:1}),V(p,{property:"create_time",label:"发起时间",width:"155"},{default:x((({row:a})=>[k("div",null,C(j(e)(new Date(Number(a.create_time)),"yyyy-MM-dd")),1)])),_:1}),V(p,{property:"status",label:"状态",width:"100"},{default:x((({row:e})=>[k("div",J,[k("div",{class:K(["status_dot",j(s)(e.status).className])},null,2),k("div",null,C(j(s)(e.status).text),1)])])),_:1}),V(p,{property:"user_name",label:"创建人"}),V(p,{label:"操作",width:"150",fixed:"right"},{default:x((({row:e})=>[k("div",Q,[4===e.status?(h(),F(f,{key:0,type:"primary",onClick:a=>t.$router.push("/product/dmp/seekpathpro/seekpathdetails?id="+e.id)},{default:x((()=>[R])),_:2},1032,["onClick"])):U("",!0),2===e.status?(h(),F(f,{key:1,type:"primary"},{default:x((()=>[X])),_:1})):U("",!0),3===e.status?(h(),F(f,{key:2,type:"primary",onClick:a=>{return l=e.fail_reason,pe.value=l,void(ie.value=!0);var l}},{default:x((()=>[G])),_:2},1032,["onClick"])):U("",!0),1===e.status&&e.attachment?(h(),F(f,{key:3,type:"primary",href:e.attachment},{default:x((()=>[L])),_:2},1032,["href"])):U("",!0),2!==e.status&&e.attachment?(h(),w("div",O)):U("",!0),2!==e.status?(h(),F(f,{key:5,type:"primary",onClick:a=>{return l=e.id,ce.value=l,void(ne.value=!0);var l}},{default:x((()=>[W])),_:2},1032,["onClick"])):U("",!0)])])),_:1})])),_:1},8,["data"])),[[je,se.value]])]),V(l,{page:de.value,"onUpdate:page":o[1]||(o[1]=e=>de.value=e),size:re.value,"onUpdate:size":o[2]||(o[2]=e=>re.value=e),total:ue.value,onChange:oe},null,8,["page","size","total"]),V(m,{modelValue:ie.value,"onUpdate:modelValue":o[3]||(o[3]=e=>ie.value=e),title:"拒绝原因",msg:pe.value,btn:1},null,8,["modelValue","msg"]),V(m,{modelValue:ne.value,"onUpdate:modelValue":o[4]||(o[4]=e=>ne.value=e),msg:"确认删除这条数据吗?",onSure:me},null,8,["modelValue"]),V(be,{modelValue:ye.value,"onUpdate:modelValue":o[11]||(o[11]=e=>ye.value=e),width:500,draggable:"",title:"添加需求","close-on-click-modal":!1},{footer:x((()=>[k("div",Y,[V(i,{onClick:o[10]||(o[10]=e=>ye.value=!1)},{default:x((()=>[Z])),_:1}),V(i,{type:"primary",onClick:xe},{default:x((()=>[ee])),_:1})])])),default:x((()=>[k("div",null,[z((h(),F(q,{ref_key:"formRef",ref:fe,model:_e.value,rules:he,"label-width":"80px"},{default:x((()=>[V(_,{label:"行业分类",required:"",prop:"industryType"},{default:x((()=>[V(y,{modelValue:_e.value.industryType,"onUpdate:modelValue":o[5]||(o[5]=e=>_e.value.industryType=e),type:"type"},null,8,["modelValue"])])),_:1}),V(_,{label:"选择地区",required:"",prop:"country"},{default:x((()=>[V(y,{modelValue:_e.value.country,"onUpdate:modelValue":o[6]||(o[6]=e=>_e.value.country=e),type:"country"},null,8,["modelValue"])])),_:1}),V(_,{label:"渠道名称",required:"",prop:"name"},{default:x((()=>[V(b,{modelValue:_e.value.name,"onUpdate:modelValue":o[7]||(o[7]=e=>_e.value.name=e),placeholder:"请输入渠道名称",clearable:""},null,8,["modelValue"])])),_:1}),V(_,{label:"渠道描述",required:"",prop:"desc"},{default:x((()=>[V(b,{modelValue:_e.value.desc,"onUpdate:modelValue":o[8]||(o[8]=e=>_e.value.desc=e),type:"textarea",maxlength:"150",rows:"4","show-word-limit":"",placeholder:"请对寻找的渠道进行简要的描述（比如找分销代理，商业服务，经销贸易等）"},null,8,["modelValue"])])),_:1}),V(_,{label:"上传附件",prop:"updateFile"},{default:x((()=>[V(v,{ref_key:"upload",ref:ge,modelValue:_e.value.updateFile,"onUpdate:modelValue":o[9]||(o[9]=e=>_e.value.updateFile=e),site:"dmp_attach",onChange:we,onError:ke,onSuccess:Ve},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])),[[je,ve.value]])])])),_:1},8,["modelValue"])])}}});export{ae as default};
