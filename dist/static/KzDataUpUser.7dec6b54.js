import{K as e}from"./KzUpload.cb238697.js";import{_ as a,C as l,e as s}from"./index.a202d357.js";import{a as u}from"./myData.c30a8b4b.js";import{H as r,u as o,ay as t,j as d,g as p,C as n,b as i,ae as m,o as c,I as v,a as g,w as f,J as b,_ as h,c as V,B as x,k as y,av as _,aw as w,a1 as F}from"./vue.fa004e33.js";const k={class:"upload-users"},U=(e=>(_("data-v-1c4eca75"),e=e(),w(),e))((()=>b("div",{class:"up-user-title"},"上传客户",-1))),q={class:"dialog-footer"},D=F("取消"),j=F("上传");var C=a(r({props:{modelValue:{type:Boolean}},emits:["update:modelValue","submitSuccess"],setup(a,{emit:r}){const _=a,w=o({get:()=>_.modelValue,set:e=>{r("update:modelValue",e)}}),F=t(),C=d({personsName:[{required:!0,message:"请输入人群名称",trigger:"change"},{required:!0,message:"请输入人群名称",trigger:"blur"}],personsDesc:[{required:!0,message:"请输入人群描述",trigger:"change"},{required:!0,message:"请输入人群描述",trigger:"blur"}],updateFile:[{required:!0,message:"请添加文件",trigger:"blur"},{validator:(e,a,l)=>{switch(N.value){case"size":l(new Error("请添加大小不超过4M的文件"));break;case"type":l(new Error("请添加 .doc、.docx、.pdf、.xls、.xlsx 格式的文件"));break;case"none":l(new Error("请添加文件"));break;default:l()}},trigger:"change"}]}),N=p("none"),E=p(),K=p(),L=p({personsName:"",personsDesc:"",updateFile:""}),M=p(!1),R=p("");n((()=>{const e="/product/dmp/mydata/up2b"===F.path?"/dmp/source/template/download.do?type=1":"/dmp/source/template/download.do?type=2";l({url:e,method:"get",headers:{"Content-Type":"application/json;charset=UTF-8",MODULE:"dmp"},responseType:"blob"}).then((e=>{R.value=URL.createObjectURL(e.data)}))}));const S=()=>{r("update:modelValue",!1)},T=()=>{E.value.validate((e=>{if(!e)return!1;M.value=!0,K.value.submit()}))},z=e=>{e?(N.value=e,L.value.updateFile="",E.value.validateField("file",(()=>null))):(N.value="",E.value.clearValidate("updateFile"))},B=e=>{L.value.updateFile="",N.value="none",K.value.clear(),M.value=!1,s("上传失败")},I=e=>{M.value=!1,u({attachment:e,group_desc:L.value.personsDesc,group_name:L.value.personsName,type:"/product/dmp/mydata/up2b"===F.path?1:2}).then((e=>{e.status?(S(),E.value.resetFields(),r("submitSuccess",1)):(L.value.updateFile="",N.value="none",K.value.clear()),M.value=!1})).catch((()=>{B()}))};return(a,l)=>{const s=i("el-input"),u=i("el-form-item"),r=i("el-form"),o=i("el-button"),t=i("el-dialog"),d=m("loading");return c(),v("div",k,[g(t,{modelValue:x(w),"onUpdate:modelValue":l[3]||(l[3]=e=>y(w)?w.value=e:null),width:500,draggable:"",onClose:S},{title:f((()=>[U])),footer:f((()=>[b("span",q,[g(o,{onClick:S},{default:f((()=>[D])),_:1}),g(o,{type:"primary",onClick:T},{default:f((()=>[j])),_:1})])])),default:f((()=>[b("div",null,[h((c(),V(r,{ref_key:"formRef",ref:E,model:L.value,rules:x(C)},{default:f((()=>[g(u,{label:"人群名称",required:"",prop:"personsName"},{default:f((()=>[g(s,{modelValue:L.value.personsName,"onUpdate:modelValue":l[0]||(l[0]=e=>L.value.personsName=e),placeholder:"请输入人群名称",clearable:""},null,8,["modelValue"])])),_:1}),g(u,{label:"人群描述",required:"",prop:"personsDesc"},{default:f((()=>[g(s,{modelValue:L.value.personsDesc,"onUpdate:modelValue":l[1]||(l[1]=e=>L.value.personsDesc=e),type:"textarea",maxlength:"150","show-word-limit":"",class:"input-textarea",placeholder:"请对人群进行简单的描述"},null,8,["modelValue"])])),_:1}),g(u,{label:"文件上传",prop:"updateFile",required:""},{default:f((()=>[g(e,{ref_key:"upload",ref:K,modelValue:L.value.updateFile,"onUpdate:modelValue":l[2]||(l[2]=e=>L.value.updateFile=e),site:"dmp_excel","down-link":R.value,"exname-list":[".doc",".docx",".pdf",".xls",".xlsx"],msg:"数据文件大小不超过2M",onChange:z,onError:B,onSuccess:I},null,8,["modelValue","down-link","exname-list"])])),_:1})])),_:1},8,["model","rules"])),[[d,M.value]])])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-1c4eca75"]]);export{C as K};
