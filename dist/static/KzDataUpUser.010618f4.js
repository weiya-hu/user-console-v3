import{K as e}from"./KzUpload.431bce51.js";import{J as a,e as l,W as s}from"./index.28f1d40d.js";import{a as u}from"./myData.087a89be.js";import{H as r,u as t,ay as o,j as d,g as p,C as n,b as i,ae as m,o as c,c as v,w as g,J as b,a as f,_ as h,B as V,k as x,a1 as y}from"./vue.fa004e33.js";const _=b("div",{class:"up-user-title"},"上传客户",-1),w={class:"dialog-footer"},F=y("取消"),k=y("上传"),U=r({props:{modelValue:{type:Boolean}},emits:["update:modelValue","submitSuccess"],setup(r,{emit:y}){const U=r,q=t({get:()=>U.modelValue,set:e=>{y("update:modelValue",e)}}),D=o(),j=d({personsName:[{required:!0,message:"请输入人群名称",trigger:"change"},{required:!0,message:"请输入人群名称",trigger:"blur"}],personsDesc:[{required:!0,message:"请输入人群描述",trigger:"change"},{required:!0,message:"请输入人群描述",trigger:"blur"}],updateFile:[{required:!0,message:"请添加文件",trigger:"blur"},{validator:(e,a,l)=>{switch(C.value){case"size":l(new Error("请添加大小不超过4M的文件"));break;case"type":l(new Error("请添加 .doc、.docx、.pdf、.xls、.xlsx 格式的文件"));break;case"none":l(new Error("请添加文件"));break;default:l()}},trigger:"change"}]}),C=p("none"),N=p(),E=p(),L=p({personsName:"",personsDesc:"",updateFile:""}),M=p(!1),R=p("");n((()=>{const e="/product/dmp/mydata/up2b"===D.path?"/dmp/source/template/download.do?type=1":"/dmp/source/template/download.do?type=2";a({url:e,method:"get",headers:{"Content-Type":"application/json;charset=UTF-8",MODULE:"dmp"},responseType:"blob"}).then((e=>{R.value=URL.createObjectURL(e.data)}))}));const S=()=>{M.value=!1,C.value="none",E.value.clear(),N.value.resetFields(),y("update:modelValue",!1)},T=()=>{N.value.validate((e=>{if(!e)return!1;M.value=!0,E.value.submit()}))},z=e=>{e?(C.value=e,L.value.updateFile="",N.value.validateField("file",(()=>null))):(C.value="",N.value.clearValidate("updateFile"))},B=e=>{L.value.updateFile="",C.value="none",E.value.clear(),M.value=!1,l("上传失败")},J=e=>{M.value=!1,u({attachment:e,group_desc:L.value.personsDesc,group_name:L.value.personsName,type:"/product/dmp/mydata/up2b"===D.path?1:2}).then((e=>{e.status?(S(),N.value.resetFields(),y("submitSuccess",1)):(L.value.updateFile="",C.value="none",E.value.clear()),M.value=!1})).catch((()=>{B()}))},K=e=>{M.value?s().then((()=>{e()})).catch((()=>{})):e()};return(a,l)=>{const s=i("el-input"),u=i("el-form-item"),r=i("el-form"),t=i("el-button"),o=i("el-dialog"),d=m("loading");return c(),v(o,{modelValue:V(q),"onUpdate:modelValue":l[3]||(l[3]=e=>x(q)?q.value=e:null),width:500,draggable:"","before-close":K,onClose:S},{title:g((()=>[_])),footer:g((()=>[b("span",w,[f(t,{disabled:M.value,onClick:S},{default:g((()=>[F])),_:1},8,["disabled"]),f(t,{type:"primary",disabled:M.value,onClick:T},{default:g((()=>[k])),_:1},8,["disabled"])])])),default:g((()=>[h((c(),v(r,{ref_key:"formRef",ref:N,model:L.value,rules:V(j),"label-width":"80px"},{default:g((()=>[f(u,{label:"人群名称",required:"",prop:"personsName"},{default:g((()=>[f(s,{modelValue:L.value.personsName,"onUpdate:modelValue":l[0]||(l[0]=e=>L.value.personsName=e),placeholder:"请输入人群名称",clearable:""},null,8,["modelValue"])])),_:1}),f(u,{label:"人群描述",required:"",prop:"personsDesc"},{default:g((()=>[f(s,{modelValue:L.value.personsDesc,"onUpdate:modelValue":l[1]||(l[1]=e=>L.value.personsDesc=e),type:"textarea",maxlength:"150","show-word-limit":"",class:"input-textarea",placeholder:"请对人群进行简单的描述"},null,8,["modelValue"])])),_:1}),f(u,{label:"文件上传",prop:"updateFile",required:""},{default:g((()=>[f(e,{ref_key:"upload",ref:E,modelValue:L.value.updateFile,"onUpdate:modelValue":l[2]||(l[2]=e=>L.value.updateFile=e),site:"dmp_excel","down-link":R.value,"exname-list":[".doc",".docx",".pdf",".xls",".xlsx"],msg:"数据文件大小不超过2M",onChange:z,onError:B,onSuccess:J},null,8,["modelValue","down-link","exname-list"])])),_:1})])),_:1},8,["model","rules"])),[[d,M.value]])])),_:1},8,["modelValue"])}}});export{U as _};
