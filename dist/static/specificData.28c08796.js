var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,d=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t;import{H as s,u,g as i,j as p,o as n,I as c,J as m,a as v,w as f,B as y,a3 as b,X as w,c as _,a1 as g,$ as h,a2 as k,ax as V,r as j,ad as C}from"./vue.a499711c.js";import{K as x}from"./KzDialog.afc18edb.js";import{K as z}from"./KzPage.9312e74c.js";import{K}from"./KzUpload.7b5bb174.js";import{_ as U}from"./KzCascader.6fd21cdd.js";import{K as O}from"./KzEmpty.61a513e5.js";import{K as D}from"./KzDmpTitle.1b8d0ed8.js";import{m as P,A as E,P as S,Q as B,S as q,e as N,E as F}from"./index.7f252a0e.js";import{f as H,h as I,i as M}from"./findB.446b4b56.js";import{f as T}from"./date.23847c74.js";import"./tinymce.275386ab.js";const A={class:"dmp_page kz_card"},J={class:"fsc mb20"},Q=k("新增需求"),R={class:"dmp_table"},X={style:{width:"100px"},class:"fcc"},$={class:"els2"},G={style:{width:"100px"},class:"fcc"},L={class:"els2"},W={style:{width:"100px"},class:"fcc"},Y={class:"els2"},Z={class:"fcs"},ee={key:0,class:"fcs"},ae=k("下载附件"),le={key:1,class:"line"},te=k("删除"),re={key:1,class:"fcs"},oe={key:2,class:"fcs"},de=k("拒绝原因"),se=m("div",{class:"line"},null,-1),ue=k("删除"),ie={key:3,class:"fcs"},pe=k("查看"),ne=m("div",{class:"line"},null,-1),ce=k("删除"),me={class:"fcs btns fjend"},ve=k("取消"),fe=k("提交"),ye=s((be=((e,a)=>{for(var l in a||(a={}))r.call(a,l)&&d(e,l,a[l]);if(t)for(var l of t(a))o.call(a,l)&&d(e,l,a[l]);return e})({},{name:"BSpecificData"}),a(be,l({setup(e){const a=P(),l=u((()=>a.state.typeHash)),t=u((()=>a.state.addressHash)),r=V(),o=i([]),d=i(1),s=i(10),k=i(0),ye=()=>{H({current:d.value,size:s.value}).then((e=>{1===e.status&&(o.value=e.body.records,k.value=e.body.total)}))};ye();const be=()=>{ye()},we=i([]),_e=e=>{we.value=e},ge=i(!1),he=i(""),ke=i({type:[],addr:[],people:"",desc:"",file:""}),Ve=i("none"),je=p({type:[{required:!0,message:"请选择行业",trigger:"change"}],addr:[{required:!0,message:"请选择地区",trigger:"change"}],people:[{required:!0,message:"请输入人群名称",trigger:"blur"}],desc:[{required:!0,message:"请输入人群描述",trigger:"blur"}],file:[{validator:(e,a,l)=>{switch(Ve.value){case"size":l(new Error("请添加大小不超过4M的文件"));break;case"type":l(new Error("请添加 .zip、.rar、.7z 格式的文件"));break;default:l()}},trigger:"change"}]}),Ce=i(!1),xe=i(),ze=e=>{e?(Ve.value=e,ke.value.file="",Ue.value.validateField("file",(()=>null))):(Ve.value="",Ue.value.clearValidate("file"))},Ke=i(!1),Ue=i(),Oe=e=>{I({attachment:e,province:Number(ke.value.addr[0])||"",city:Number(ke.value.addr[1])||"",district:Number(ke.value.addr[2])||"",group_desc:ke.value.desc,group_name:ke.value.people,industry_id:ke.value.type.join(",")}).then((e=>{1===e.status?(Pe(),ye()):(ke.value.file="",Ve.value="none",xe.value.clear(),Ke.value=!1)})).catch((()=>{De("")}))},De=e=>{ke.value.file="",Ve.value="none",xe.value.clear(),Ke.value=!1,N("上传失败")},Pe=()=>{Ce.value=!1,Ke.value=!1,Ve.value="none",xe.value.clear(),Ue.value.resetFields()},Ee=e=>{Ke.value?F.confirm("正在上传中，关闭弹窗可能会导致上传失败，是否继续关闭？","温馨提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{e()})).catch((()=>{})):e()},Se=i(""),Be=i(!1),qe=e=>{Se.value=e,Be.value=!0},Ne=()=>{M({id:Se.value}).then((e=>{1===e.status&&(Be.value=!1,ye())}))};return(e,a)=>{const u=j("el-button"),i=j("el-table-column"),p=j("el-tooltip"),V=j("el-link"),P=j("el-table"),N=j("el-form-item"),F=j("el-input"),H=j("el-form"),I=j("el-dialog"),M=C("loading");return n(),c("div",A,[m("div",J,[v(D),v(u,{type:"primary",icon:y(E),onClick:a[0]||(a[0]=e=>Ce.value=!0)},{default:f((()=>[Q])),_:1},8,["icon"])]),m("div",R,[v(P,{data:o.value,style:{width:"100%"},onSelectionChange:_e},{empty:f((()=>[v(O)])),default:f((()=>[v(i,{type:"selection",width:"50"}),v(i,{property:"id",label:"ID",width:"165"}),v(i,{property:"type",label:"行业分类",width:"150"},{default:f((e=>[m("div",null,b(y(S)(e.row.industry_id.split(","),y(l),"last")),1)])),_:1}),v(i,{property:"addr",label:"地区",width:"180"},{default:f((e=>[v(p,{effect:"dark",placement:"top"},{content:f((()=>[m("div",X,b(y(S)(y(B)(e.row.province,e.row.city,e.row.district),y(t))),1)])),default:f((()=>[m("div",$,b(y(S)(y(B)(e.row.province,e.row.city,e.row.district),y(t))),1)])),_:2},1024)])),_:1}),v(i,{property:"group_name",label:"人群名称",width:"200"},{default:f((({row:e})=>[v(p,{effect:"dark",placement:"top"},{content:f((()=>[m("div",G,b(e.group_name),1)])),default:f((()=>[m("div",L,b(e.group_name),1)])),_:2},1024)])),_:1}),v(i,{property:"group_desc",label:"人群描述",width:"300"},{default:f((({row:e})=>[v(p,{effect:"dark",placement:"top"},{content:f((()=>[m("div",W,b(e.group_desc),1)])),default:f((()=>[m("div",Y,b(e.group_desc),1)])),_:2},1024)])),_:1}),v(i,{property:"create_time",label:"发起时间",width:"155"},{default:f((e=>[m("div",null,b(y(T)(new Date(e.row.create_time),"yyyy-MM-dd")),1)])),_:1}),v(i,{property:"status",label:"状态",width:"100"},{default:f((e=>[m("div",Z,[m("div",{class:w(["status_dot",y(q)(e.row.status).className])},null,2),m("div",null,b(y(q)(e.row.status).text),1)])])),_:1}),v(i,{label:"操作",width:"150",fixed:"right"},{default:f((e=>[1==e.row.status?(n(),c("div",ee,[e.row.attachment?(n(),_(V,{key:0,type:"primary",href:e.row.attachment},{default:f((()=>[ae])),_:2},1032,["href"])):g("",!0),e.row.attachment?(n(),c("div",le)):g("",!0),v(V,{type:"primary",onClick:a=>qe(e.row.id)},{default:f((()=>[te])),_:2},1032,["onClick"])])):g("",!0),2==e.row.status?(n(),c("div",re,"---")):g("",!0),3==e.row.status?(n(),c("div",oe,[v(V,{type:"primary",onClick:a=>{return l=e.row.fail_reason,he.value=l,void(ge.value=!0);var l}},{default:f((()=>[de])),_:2},1032,["onClick"]),se,v(V,{type:"primary",onClick:a=>qe(e.row.id)},{default:f((()=>[ue])),_:2},1032,["onClick"])])):g("",!0),4==e.row.status?(n(),c("div",ie,[v(V,{type:"primary",onClick:a=>{return l=e.row.id,void r.push("/product/dmp/findb/specificDataDetails?id="+l);var l}},{default:f((()=>[pe])),_:2},1032,["onClick"]),ne,v(V,{type:"primary",onClick:a=>qe(e.row.id)},{default:f((()=>[ce])),_:2},1032,["onClick"])])):g("",!0)])),_:1})])),_:1},8,["data"])]),v(z,{page:d.value,"onUpdate:page":a[1]||(a[1]=e=>d.value=e),size:s.value,"onUpdate:size":a[2]||(a[2]=e=>s.value=e),total:k.value,onChange:be},null,8,["page","size","total"]),v(I,{modelValue:Ce.value,"onUpdate:modelValue":a[9]||(a[9]=e=>Ce.value=e),title:"新建数据",width:"500px","before-close":Ee,onClose:Pe},{footer:f((()=>[m("div",me,[v(u,{onClick:Pe},{default:f((()=>[ve])),_:1}),v(u,{type:"primary",onClick:a[8]||(a[8]=e=>{var a;(a=Ue.value)&&(Ve.value="none",a.validate((e=>{if(!e)return!1;Ke.value=!0,ke.value.file?xe.value.submit():Oe("")})))})},{default:f((()=>[fe])),_:1})])])),default:f((()=>[h((n(),_(H,{ref_key:"addFormRef",ref:Ue,class:"myform",model:ke.value,rules:je,"label-width":"80px"},{default:f((()=>[v(N,{label:"行业分类",prop:"type"},{default:f((()=>[v(U,{modelValue:ke.value.type,"onUpdate:modelValue":a[3]||(a[3]=e=>ke.value.type=e),type:"type"},null,8,["modelValue"])])),_:1}),v(N,{label:"选择地区",prop:"addr"},{default:f((()=>[v(U,{modelValue:ke.value.addr,"onUpdate:modelValue":a[4]||(a[4]=e=>ke.value.addr=e),type:"address"},null,8,["modelValue"])])),_:1}),v(N,{label:"人群名称",prop:"people"},{default:f((()=>[v(F,{modelValue:ke.value.people,"onUpdate:modelValue":a[5]||(a[5]=e=>ke.value.people=e),placeholder:"请输入人群名称"},null,8,["modelValue"])])),_:1}),v(N,{label:"人群描述",prop:"desc"},{default:f((()=>[v(F,{modelValue:ke.value.desc,"onUpdate:modelValue":a[6]||(a[6]=e=>ke.value.desc=e),placeholder:"可对人群进行简单的描述",type:"textarea",maxlength:"150","show-word-limit":"",rows:"4"},null,8,["modelValue"])])),_:1}),v(N,{label:"上传附件",prop:"file",style:{"margin-bottom":"0"}},{default:f((()=>[v(K,{ref_key:"upload",ref:xe,modelValue:ke.value.file,"onUpdate:modelValue":a[7]||(a[7]=e=>ke.value.file=e),site:"dmp_attach",onChange:ze,onError:De,onSuccess:Oe},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])),[[M,Ke.value]])])),_:1},8,["modelValue"]),v(x,{modelValue:ge.value,"onUpdate:modelValue":a[10]||(a[10]=e=>ge.value=e),title:"拒绝原因",msg:he.value,btn:1},null,8,["modelValue","msg"]),v(x,{modelValue:Be.value,"onUpdate:modelValue":a[11]||(a[11]=e=>Be.value=e),msg:"确认删除这条数据吗?",onSure:Ne},null,8,["modelValue"])])}}}))));var be;export{ye as default};
