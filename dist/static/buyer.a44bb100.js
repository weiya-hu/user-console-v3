import{f as e}from"./date.23847c74.js";import{K as a}from"./KzEmpty.640dfbae.js";import{K as l}from"./KzPage.0e73684e.js";import{K as t}from"./KzUpload.cb238697.js";import{_ as u,m as r,A as s,O as d,R as o,e as i}from"./index.a202d357.js";import{_ as p}from"./KzCascader.598b8622.js";import{H as n,u as c,g as m,j as v,o as y,I as f,J as _,a as b,w as g,B as h,_ as w,c as k,a2 as V,W as x,a0 as z,P as F,aa as j,av as q,aw as C,a1 as U,ax as K,b as T,ae as E}from"./vue.fa004e33.js";import{o as D,a as I}from"./seekAbroad.0a4c3f95.js";import"./tinymce.50e98bcc.js";const M={class:"kz_card my_buyer_page"},A={class:"fsc f1"},H=(e=>(q("data-v-1af8ba85"),e=e(),C(),e))((()=>_("div",{class:"card_title"},"采购商",-1))),N=U("上传数据"),P={class:"dmp_table"},R={class:"fcs"},B={class:"fcs"},J=U("详情"),L=U("---"),O=U("驳回原因"),S=U("删除"),W={class:"flexr"},$=U("取消"),G=U("确认");var Q=u(n({setup(u){const n=r(),q=c((()=>n.state.typeHash)),C=m(0),U=m(10),Q=m(1);K();const X=m(!1),Y=m(!1),Z=m(!1),ee=m(),ae=m(),le=m();n.getCountryList().then((e=>{le.value=e}));const te=m({industryType:[],country:"",name:"",desc:"",updateFile:""}),ue=m(),re=m([]),se=v({industryType:[{required:!0,message:"请选择行业分类",trigger:"blur"}],country:[{required:!0,message:"请选择地区",trigger:"blur"},{required:!0,message:"请选择地区",trigger:"change"}],name:[{required:!0,message:"请输入供应商品",trigger:"change"},{required:!0,message:"请输入供应商品",trigger:"blur"}],desc:[{required:!0,message:"请输入描述",trigger:"change"},{required:!0,message:"请输入描述",trigger:"blur"}],updateFile:[{validator:(e,a,l)=>{switch(ue.value){case"size":l(new Error("请添加大小不超过4M的文件"));break;case"type":l(new Error("请添加 .doc、.docx、.pdf、.xls、.xlsx 格式的文件"));break;case"none":l(new Error("请添加文件"));break;default:l()}},trigger:"change"}]}),de=async()=>{X.value=!0;const e={current:Q.value,type:1,size:U.value},{status:a,body:l}=await D(e);X.value=!1,a&&(C.value=l.total,re.value=l.records)};de();const oe=()=>{Z.value=!0},ie=()=>{ee.value.validate((e=>{if(!e)return!1;Y.value=!0,te.value.updateFile?ae.value.submit():ce()}))},pe=e=>{e?(ue.value=e,te.value.updateFile="",ee.value.validateField("updateFile",(()=>null))):(ue.value="",ee.value.clearValidate("updateFile"))},ne=e=>{te.value.updateFile="",ue.value="none",ae.value.clear(),Y.value=!1,i("上传失败")},ce=e=>{I({attachment:e||"",demand_desc:te.value.desc,product_name:te.value.name,type:1,country_id:te.value.country,industry_id:te.value.industryType.join(",")}).then((e=>{e.status?(Z.value=!1,ee.value.resetFields(),Q.value=1,de()):(te.value.updateFile="",ae.value.clear()),Y.value=!1})).catch((()=>{Y.value=!1,ne()}))};return(u,r)=>{const i=T("el-icon"),n=T("el-button"),c=T("el-table-column"),m=T("el-link"),v=T("el-table"),K=T("el-form-item"),D=T("el-option"),I=T("el-select"),ue=T("el-input"),me=T("el-form"),ve=T("el-dialog"),ye=E("loading");return y(),f("div",M,[_("div",A,[H,b(n,{type:"primary",class:"btns",onClick:oe},{default:g((()=>[b(i,{size:"14px",style:{"margin-right":"4px"}},{default:g((()=>[b(h(s))])),_:1}),N])),_:1})]),_("div",P,[w((y(),k(v,{data:re.value,size:"large","row-class-name":"my-data-table-row"},{empty:g((()=>[b(a)])),default:g((()=>[b(c,{type:"selection",width:"50"}),b(c,{property:"id",label:"ID"}),b(c,{property:"industry_id",label:"行业分类"},{default:g((e=>[_("div",null,V(h(d)(e.row.industry_id.split(","),h(q),"last")),1)])),_:1}),b(c,{property:"country_id",label:"地区"}),b(c,{property:"product_name",label:"供应商品"}),b(c,{property:"demand_desc",label:"描述"}),b(c,{property:"create_time",label:"发起时间"},{default:g((({row:a})=>[_("div",null,V(h(e)(new Date(Number(a.create_time)),"yyyy-MM-dd")),1)])),_:1}),b(c,{property:"status",label:"状态"},{default:g((({row:e})=>[_("div",R,[_("div",{class:x(["status_dot",h(o)(e.status).className])},null,2),_("div",null,V(h(o)(e.status).text),1)])])),_:1}),b(c,{property:"user_name",label:"创建人"}),b(c,{label:"操作",width:"300"},{default:g((({row:e})=>[_("div",B,[4===e.status?(y(),k(m,{key:0,type:"primary",onClick:a=>u.$router.push("/product/dmp/myData/buyerdetails?id="+e.id)},{default:g((()=>[J])),_:2},1032,["onClick"])):z("",!0),2===e.status?(y(),k(m,{key:1,type:"primary"},{default:g((()=>[L])),_:1})):z("",!0),3===e.status?(y(),k(m,{key:2,type:"primary"},{default:g((()=>[O])),_:1})):z("",!0),2!==e.status?(y(),k(m,{key:3,type:"primary"},{default:g((()=>[S])),_:1})):z("",!0)])])),_:1})])),_:1},8,["data"])),[[ye,X.value]])]),b(l,{page:Q.value,"onUpdate:page":r[0]||(r[0]=e=>Q.value=e),size:U.value,"onUpdate:size":r[1]||(r[1]=e=>U.value=e),total:C.value,onChange:de},null,8,["page","size","total"]),b(ve,{modelValue:Z.value,"onUpdate:modelValue":r[8]||(r[8]=e=>Z.value=e),width:500,draggable:"",title:"添加需求","close-on-click-modal":!1},{footer:g((()=>[_("div",W,[b(n,{onClick:r[7]||(r[7]=e=>Z.value=!1)},{default:g((()=>[$])),_:1}),b(n,{type:"primary",onClick:ie},{default:g((()=>[G])),_:1})])])),default:g((()=>[_("div",null,[w((y(),k(me,{ref_key:"formRef",ref:ee,model:te.value,rules:h(se),"label-position":"left","label-width":"80px",class:"my_form"},{default:g((()=>[b(K,{label:"行业分类",required:"",prop:"industryType"},{default:g((()=>[b(p,{modelValue:te.value.industryType,"onUpdate:modelValue":r[2]||(r[2]=e=>te.value.industryType=e),type:"type"},null,8,["modelValue"])])),_:1}),b(K,{label:"地区",prop:"country"},{default:g((()=>[b(I,{modelValue:te.value.country,"onUpdate:modelValue":r[3]||(r[3]=e=>te.value.country=e),class:"sele_add",placeholder:"请选择地区",size:"large",clearable:""},{default:g((()=>[(y(!0),f(F,null,j(le.value,(e=>(y(),k(D,{key:e.code,label:e.country_name,value:e.code,size:"large"},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),b(K,{label:"供应商品",required:"",prop:"name",size:"large"},{default:g((()=>[b(ue,{modelValue:te.value.name,"onUpdate:modelValue":r[4]||(r[4]=e=>te.value.name=e),placeholder:"请输入产品名称",clearable:""},null,8,["modelValue"])])),_:1}),b(K,{label:"描述",required:"",prop:"desc"},{default:g((()=>[b(ue,{modelValue:te.value.desc,"onUpdate:modelValue":r[5]||(r[5]=e=>te.value.desc=e),type:"textarea",maxlength:"150","show-word-limit":"",class:"input_textarea",placeholder:"可简要描述对寻找地区的采购服务商的要求。",rows:3},null,8,["modelValue"])])),_:1}),b(K,{label:"上传附件",prop:"updateFile"},{default:g((()=>[b(t,{ref_key:"upload",ref:ae,modelValue:te.value.updateFile,"onUpdate:modelValue":r[6]||(r[6]=e=>te.value.updateFile=e),site:"dmp_attach",onChange:pe,onError:ne,onSuccess:ce},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])),[[ye,Y.value]])])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-1af8ba85"]]);export{Q as default};
