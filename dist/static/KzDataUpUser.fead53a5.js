import{K as e}from"./KzUpload.e32ad148.js";import{K as a,e as l,Y as s}from"./index.561f5261.js";import{a as u}from"./myData.86ad8934.js";import{H as r,u as t,ay as o,j as d,g as p,C as n,r as i,ad as m,o as c,c as v,w as g,J as f,a as b,$ as h,B as V,k as x,a2 as y}from"./vue.a499711c.js";const w=f("div",{class:"up-user-title"},"上传客户",-1),F={class:"dialog-footer"},_=y("取消"),U=y("上传"),k=r({name:"KzDataUpUser",props:{modelValue:{type:Boolean}},emits:["update:modelValue","submitSuccess"],setup(r,{emit:y}){const k=r,D=t({get:()=>k.modelValue,set:e=>{y("update:modelValue",e)}}),q=o(),j=d({personsName:[{required:!0,message:"请输入人群名称",trigger:"change"},{required:!0,message:"请输入人群名称",trigger:"blur"}],personsDesc:[{required:!0,message:"请输入人群描述",trigger:"change"},{required:!0,message:"请输入人群描述",trigger:"blur"}],updateFile:[{required:!0,message:"请添加文件",trigger:"blur"},{validator:(e,a,l)=>{switch(C.value){case"size":l(new Error("请添加大小不超过4M的文件"));break;case"type":l(new Error("请添加 .doc、.docx、.pdf、.xls、.xlsx 格式的文件"));break;case"none":l(new Error("请添加文件"));break;default:l()}},trigger:"change"}]}),C=p("none"),N=p(),E=p(),K=p({personsName:"",personsDesc:"",updateFile:""}),z=p(!1),L=p("");n((()=>{const e="/product/dmp/mydata/up2b"===q.path?"/dmp/source/template/download.do?type=1":"/dmp/source/template/download.do?type=2";a({url:e,method:"get",headers:{"Content-Type":"application/json;charset=UTF-8",MODULE:"dmp"},responseType:"blob"}).then((e=>{L.value=URL.createObjectURL(e.data)}))}));const M=()=>{z.value=!1,C.value="none",E.value.clear(),N.value.resetFields(),y("update:modelValue",!1)},R=()=>{N.value.validate((e=>{if(!e)return!1;z.value=!0,E.value.submit()}))},S=e=>{e?(C.value=e,K.value.updateFile="",N.value.validateField("file",(()=>null))):(C.value="",N.value.clearValidate("updateFile"))},T=e=>{K.value.updateFile="",C.value="none",E.value.clear(),z.value=!1,l("上传失败")},B=e=>{z.value=!1,u({attachment:e,group_desc:K.value.personsDesc,group_name:K.value.personsName,type:"/product/dmp/mydata/up2b"===q.path?1:2}).then((e=>{e.status?(M(),N.value.resetFields(),y("submitSuccess",1)):(K.value.updateFile="",C.value="none",E.value.clear()),z.value=!1})).catch((()=>{T()}))},O=e=>{z.value?s().then((()=>{e()})).catch((()=>{})):e()};return(a,l)=>{const s=i("el-input"),u=i("el-form-item"),r=i("el-form"),t=i("el-button"),o=i("el-dialog"),d=m("loading");return c(),v(o,{modelValue:V(D),"onUpdate:modelValue":l[3]||(l[3]=e=>x(D)?D.value=e:null),width:500,draggable:"","before-close":O,onClose:M},{title:g((()=>[w])),footer:g((()=>[f("span",F,[b(t,{disabled:z.value,onClick:M},{default:g((()=>[_])),_:1},8,["disabled"]),b(t,{type:"primary",disabled:z.value,onClick:R},{default:g((()=>[U])),_:1},8,["disabled"])])])),default:g((()=>[h((c(),v(r,{ref_key:"formRef",ref:N,model:K.value,rules:j,"label-width":"80px"},{default:g((()=>[b(u,{label:"人群名称",required:"",prop:"personsName"},{default:g((()=>[b(s,{modelValue:K.value.personsName,"onUpdate:modelValue":l[0]||(l[0]=e=>K.value.personsName=e),placeholder:"请输入人群名称",clearable:""},null,8,["modelValue"])])),_:1}),b(u,{label:"人群描述",required:"",prop:"personsDesc"},{default:g((()=>[b(s,{modelValue:K.value.personsDesc,"onUpdate:modelValue":l[1]||(l[1]=e=>K.value.personsDesc=e),type:"textarea",maxlength:"150","show-word-limit":"",class:"input-textarea",placeholder:"请对人群进行简单的描述"},null,8,["modelValue"])])),_:1}),b(u,{label:"文件上传",prop:"updateFile",required:""},{default:g((()=>[b(e,{ref_key:"upload",ref:E,modelValue:K.value.updateFile,"onUpdate:modelValue":l[2]||(l[2]=e=>K.value.updateFile=e),site:"dmp_excel","down-link":L.value,"exname-list":[".doc",".docx",".pdf",".xls",".xlsx"],msg:"数据文件大小不超过2M",onChange:S,onError:T,onSuccess:B},null,8,["modelValue","down-link","exname-list"])])),_:1})])),_:1},8,["model","rules"])),[[d,z.value]])])),_:1},8,["modelValue"])}}});export{k as _};
