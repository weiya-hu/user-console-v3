var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,r=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,u=(e,a)=>{for(var l in a||(a={}))s.call(a,l)&&r(e,l,a[l]);if(t)for(var l of t(a))d.call(a,l)&&r(e,l,a[l]);return e};import{_ as i,e as o,z as n,A as c,B as m,C as p,g as f,p as g,t as b}from"./index.fde176ed.js";import{H as v,C as y,q as _,g as h,r as x,o as V,I as w,a as j,w as S,W as U,J as O,X as q,B as I,av as N,aw as k,j as z,$ as P,c as C,a1 as L,a2 as E,ay as D,ax as A,ad as R}from"./vue.a499711c.js";import{_ as B}from"./KzCascader.4e0226ed.js";import"./tinymce.275386ab.js";const F={class:"fc fcc"},G=(e=>(N("data-v-1925d450"),e=e(),k(),e))((()=>O("div",{class:"file_name"},"拖拽/点击上传",-1))),H=["innerHTML"];var J=i(v({name:"kzImgUpload",props:{exnameList:{default:()=>[".jpg",".png",".jpeg",".JPG",".PNG",".JPEG"]},max:{default:1},msg:{default:""},maxSize:{default:2},imgList:{default:()=>[]},needDownload:{type:Boolean,default:!1},site:{default:"official_img"}},emits:["upOneSuccess","upAllSuccess","error","change","del"],setup(e,{expose:t,emit:s}){const d=e,r=()=>{if(d.imgList.length&&d.imgList.forEach(((e,a)=>{i.value.push({url:e,name:"",status:"success",uid:-a-1}),N.value.push({url:e,name:"",status:"success",uid:-a-1,upUrl:e})})),d.imgList.length>=d.max){document.querySelector(".el-upload--picture-card").style.display="none"}};y((()=>{_((()=>{r()}))}));const i=h([]),f=h(),g=(e,a)=>{if(!e.name||"fail"===e.status)return;const l=e.name.substring(e.name.lastIndexOf("."));if(-1===d.exnameList.indexOf(l))return f.value.handleRemove(e),void o("图片格式错误！");if(e.size&&e.size/1024/1024>d.maxSize)return f.value.handleRemove(e),void o(`图片文件大小不能超过${d.maxSize}M`);i.value=a;const t=document.querySelector(".el-upload--picture-card");i.value.length>=d.max&&(t.style.display="none");const r=e.name.substring(0,e.name.indexOf("."));s("change",r)},b=(e,a)=>{const l=N.value.findIndex((a=>a.upUrl===e.url||a.uid===e.uid));l>-1&&N.value.splice(l,1),i.value=a,s("del"),document.querySelector(".el-upload--picture-card").style.display="inline-flex"},v=e=>{const a=[];i.value.forEach((e=>{a.push(e.url)})),n(a,a.findIndex((a=>a===e.url)))},N=h([]),k=()=>{N.value.length===i.value.length&&N.value.length&&s("upAllSuccess",N.value.map((e=>e.upUrl)))},z=async(e,t)=>{if("success"===e.status||!e.raw)return;const r=await m({site:d.site});if(1==r.status){const n=e.name.substring(e.name.lastIndexOf(".")),c=new FormData,m={key:r.body.dir+"/"+r.body.uuid+n,OSSAccessKeyId:r.body.accessid,success_action_status:"200",policy:r.body.policy,signature:r.body.signature};if(d.needDownload){const a=t?t+n:e.name;m["Content-Disposition"]="attachment; filename="+encodeURIComponent(a)}for(const[e,a]of Object.entries(m))c.append(e,a);c.append("file",e.raw);if(200==(await p({url:r.body.host,method:"post",headers:{"Content-Type":"multipart/form-data;"},data:c})).status){const t=r.body.host+"/"+r.body.dir+"/"+r.body.uuid+n;return N.value.push((o=u({},e),a(o,l({upUrl:t})))),k(),s("upOneSuccess",t,i.value.length),Promise.resolve(t)}return Promise.reject(e.name+"上传失败")}var o;return Promise.reject("获取上传配置失败")},P=e=>{1==d.max&&(f.value.clearFiles(),f.value.handleStart(e[0]))};return t({submit:async e=>{k();try{for(let a=0;a<i.value.length;a++){const l=i.value[a];N.value.findIndex((e=>l.uid===e.uid))>-1||await z(l,e).catch((e=>{throw i.value.splice(a,1),document.querySelector(".el-upload--picture-card").style.display="inline-flex",new Error(e)}))}}catch(a){s("error",a)}},clear:()=>{i.value.length=0,N.value.length=0,document.querySelector(".el-upload--picture-card").style.display="inline-flex"},imgs:i,sucImgs:N,setImgs:r}),(a,l)=>{const t=x("el-icon"),s=x("el-upload");return V(),w("div",{class:q(["media_upload flex",1==e.max?"one_up":"alls_up"])},[j(s,{ref_key:"upload",ref:f,drag:"",action:"#","auto-upload":!1,limit:e.max,multiple:e.max>1,"list-type":"picture-card","on-exceed":P,"on-change":g,"on-preview":v,"on-remove":b,accept:e.exnameList.join(","),class:"upbox","file-list":e.imgList.map((e=>({name:"",url:e})))},{default:S((()=>[U(a.$slots,"default",{},(()=>[O("div",F,[j(t,null,{default:S((()=>[j(I(c))])),_:1}),G])]),!0)])),_:3},8,["limit","multiple","accept","file-list"]),O("div",{class:"tips",innerHTML:e.msg},null,8,H)],2)}}}),[["__scopeId","data-v-1925d450"]]);const K=e=>g("user","/web/company/audit/save.do",e,!0);const M=e=>(N("data-v-3875140e"),e=e(),k(),e),T={class:"rz"},$={class:"imgs"},W=M((()=>O("div",null,"*请上传资质编号清晰的资质照片；",-1))),X=M((()=>O("div",null,"仅支持jpg、png、jpeg格式图片，最多上传2张。",-1))),Q=E("永久"),Y={class:"preser"},Z=E("保存认证消息"),ee=E("提交认证");var ae=i(v({name:"authentication",setup(e){const a=h(),l=D().query.id,t=h([]),s=h(!1),d=h();(async()=>{if(s.value=!1,l){const{body:a,status:s}=await(e={id:Number(l)},f("user","/web/company/audit.get",e));d.value=a.status,1===s&&(r.name=a.name,r.industry_id=a.industry_id.split(","),r.left_time=a.left_time,r.legal_person=a.legal_person,r.business_scope=a.business_scope,r.code=a.code,r.contact=a.contact,r.address=a.address,r.url=a.url,r.license=a.license,r.license&&r.license.split(",").forEach((e=>{t.value.push(e)})),r.addr=[a.province,a.city,a.district],r.imgName=a.license?"oldName":"")}var e;s.value=!0})();const r=z({name:"",industry_id:[],left_time:"",legal_person:"",resource:"",business_scope:"",code:"",contact:"",address:"",url:"",addr:[],license:"",imgName:""}),i=h(!1),n=h(),c={name:[{required:!0,message:"请输入企业名称",trigger:"blur"}],industry_id:[{required:!0,message:"请输入行业分类",trigger:"change"}],left_time:[{required:!0,message:"请输入证件有效期",trigger:"change"}],legal_person:[{required:!0,message:"请输入联系人",trigger:"blur"}],contact:[{required:!0,message:"请输入联系电话",trigger:"blur"},{validator:(e,a,l)=>{b.test(a)?l():l(new Error("请输入正确的手机号码!"))},trigger:"blur"}],addr:[{required:!0,message:"请选择地址",trigger:"blur"}],imgName:[{required:!0,message:"请添加资质照片",trigger:"change"},{validator:(e,a,l)=>{n.value.imgs.length&&l(),l(new Error("请添加资质照片！"))},trigger:"change"}],code:[{required:!0,message:"请输入统一社会信用代码",trigger:"blur"}]},m=async e=>{var a;await(a={code:e},g("user","/web/company/code/check.do",a))},p=e=>{o(e),i.value=!1},v=async e=>{const a={city:r.addr[1]||0,province:r.addr[0]||0,district:r.addr[2],industry_id:r.industry_id.join(","),left_time:Number(r.left_time),id:Number(l)};r.license=e.toString();var t;1===(1===q.value?await K(u(u({},r),a)):await(t=u(u({},r),a),g("user","/web/company/audit/submit.do",t,!0))).status&&U.back()},y=e=>{r.imgName=e,a.value.clearValidate("imgName")},_=()=>{0===n.value.imgs.length&&(r.imgName="")},U=A(),q=h(1),I=async e=>{q.value=e;const t={city:r.addr[1]||0,province:r.addr[0]||0,district:r.addr[2],industry_id:r.industry_id.join(","),left_time:Number(r.left_time),id:Number(l)};if(1===q.value){if(r.imgName)return a.value.clearValidate(),void n.value.submit();1===(await K(u(u({},r),t))).status&&U.back()}else a.value.validate((e=>{e&&n.value.submit()}))};return(e,l)=>{const u=x("el-form-item"),o=x("el-input"),f=x("el-date-picker"),g=x("el-checkbox"),b=x("KzIcon"),h=x("el-link"),U=x("el-button"),q=x("el-form"),N=R("loading");return V(),w("div",T,[P((V(),C(q,{ref_key:"ruleFormRef",ref:a,model:r,rules:c,"label-width":"150px",class:"demo-ruleForm",size:"large"},{default:S((()=>[j(u,{label:"行业分类",prop:"industry_id"},{default:S((()=>[j(B,{ref:"typeCRef",modelValue:r.industry_id,"onUpdate:modelValue":l[0]||(l[0]=e=>r.industry_id=e),type:"type",placeholder:"请选择行业",disabled:2===d.value},null,8,["modelValue","disabled"])])),_:1}),j(u,{label:"企业名称",prop:"name"},{default:S((()=>[j(o,{modelValue:r.name,"onUpdate:modelValue":l[1]||(l[1]=e=>r.name=e),placeholder:"请输入",disabled:2===d.value},null,8,["modelValue","disabled"])])),_:1}),j(u,{label:"统一社会信用代码",prop:"code"},{default:S((()=>[j(o,{modelValue:r.code,"onUpdate:modelValue":l[2]||(l[2]=e=>r.code=e),placeholder:"请输入",disabled:2===d.value,onBlur:l[3]||(l[3]=e=>m(r.code))},null,8,["modelValue","disabled"])])),_:1}),j(u,{label:"资质照片",prop:"imgName"},{default:S((()=>[O("div",$,[s.value?(V(),C(J,{key:0,ref_key:"upload",ref:n,max:2,"img-list":t.value,onUpAllSuccess:v,onError:p,onChange:y,onDel:_},null,8,["img-list"])):L("",!0),W,X])])),_:1}),j(u,{label:"证件有效期",required:""},{default:S((()=>[j(u,{prop:"left_time"},{default:S((()=>[j(f,{modelValue:r.left_time,"onUpdate:modelValue":l[4]||(l[4]=e=>r.left_time=e),type:"date","value-format":"x",disabled:2===d.value},null,8,["modelValue","disabled"]),j(g,{modelValue:r.left_time,"onUpdate:modelValue":l[5]||(l[5]=e=>r.left_time=e),"true-label":"4102415999000",disabled:2===d.value},{default:S((()=>[Q])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1}),j(u,{label:"联系人",prop:"legal_person"},{default:S((()=>[j(o,{modelValue:r.legal_person,"onUpdate:modelValue":l[6]||(l[6]=e=>r.legal_person=e),placeholder:"请输入",disabled:2===d.value},null,8,["modelValue","disabled"])])),_:1}),j(u,{label:"联系电话",prop:"contact"},{default:S((()=>[j(o,{modelValue:r.contact,"onUpdate:modelValue":l[7]||(l[7]=e=>r.contact=e),placeholder:"请输入",disabled:2===d.value},null,8,["modelValue","disabled"])])),_:1}),j(u,{label:"省份地区",prop:"addr"},{default:S((()=>[j(B,{modelValue:r.addr,"onUpdate:modelValue":l[8]||(l[8]=e=>r.addr=e),type:"address",placeholder:"请选择地址",disabled:2===d.value},null,8,["modelValue","disabled"])])),_:1}),j(u,{label:"详细地址",prop:"address"},{default:S((()=>[j(o,{modelValue:r.address,"onUpdate:modelValue":l[9]||(l[9]=e=>r.address=e),placeholder:"请输入",disabled:2===d.value},null,8,["modelValue","disabled"])])),_:1}),j(u,{label:"官方网站",prop:"url"},{default:S((()=>[j(o,{modelValue:r.url,"onUpdate:modelValue":l[10]||(l[10]=e=>r.url=e),placeholder:"请输入",disabled:2===d.value},null,8,["modelValue","disabled"])])),_:1}),j(u,{label:"经营范围",prop:"business_scope"},{default:S((()=>[j(o,{modelValue:r.business_scope,"onUpdate:modelValue":l[11]||(l[11]=e=>r.business_scope=e),placeholder:"请填写经营范围",type:"textarea",clearable:"",disabled:2===d.value},null,8,["modelValue","disabled"])])),_:1}),O("div",Y,[j(h,{type:"primary",class:"fcc",disabled:2===d.value,onClick:l[12]||(l[12]=e=>I(1))},{default:S((()=>[j(b,{href:"#icon-baocun"}),Z])),_:1},8,["disabled"])]),j(u,null,{default:S((()=>[j(U,{type:"primary",class:"sub",disabled:2===d.value,onClick:l[13]||(l[13]=e=>I(2))},{default:S((()=>[ee])),_:1},8,["disabled"])])),_:1})])),_:1},8,["model"])),[[N,i.value]])])}}}),[["__scopeId","data-v-3875140e"]]);export{ae as default};
